# Приложение расчёта характеристик спектра и фона дифрактограмм

## Описание

Приложение реализует обработку первичных дифрактограмм в формате текстовых файлов, полученных в результате исследования веществ методом Дебая-Шеррера. Решает проблемы анализа кривых с выбросами и нелокализованными экстремумами, предоставляя таблицу параметров и очищенную от шума дифракционную кривую. Данное программное обеспечение разрабатывается для “Института перспективных технологий и индустриального программирования” (ИПТИП) для изучения свойств исследуемых материалов, отображенных на дифрактограммах. 

## Запуск приложения

### Основной режим:
```bash
marimo run [OPTIONS: --port --host --proxy --headless --token] App.py [ARGS]
```

### Режим редактирования/ноутбука:
```bash
marimo --yes edit --host=localhost --port=2818 --headless --no-token
```

## Архитектура приложения

Приложение состоит из 5 микросервисных модулей:

1. **App** - главный модуль с пользовательским интерфейсом:
   - Предоставляет UI для работы с дифрактограммами
   - Обеспечивает ввод параметров и визуализацию результатов
   - Реализует экспорт отчёта, таблиц и графиков

2. **file_parser** - модуль парсинга дифрактограмм:
   - Обрабатывает файлы форматов .txt, .dat
   - Извлекает данные для последующего анализа

3. **smoothing_module** - модуль сглаживания:
   - Устраняет шумы и выбросы
   - Применяет методы машинного обучения для сглаживания кривой

4. **peaks_search_module** - модуль поиска пиков:
   - Выявляет глобальные пики на дифрактограмме
   - Вычисляет центры масс пиков
   - Формирует таблицу характеристик

5. **calculate_module** - модуль расчётов:
   - Находит регрессионное уравнение базовой линии
   - Вычисляет интегральную интенсивность
   - Определяет параметры кристаллической решётки

## Функционал

### Входные данные:
- Загрузка дифрактограмм (форматы .txt, .dat)
- Настройка параметров обработки через формы ввода marimo

### Аналитические функции:
- Автоматическое сглаживание кривой
- Поиск и характеристика пиков
- Расчёт базовой линии
- Определение интегральной и максимальной интенсивностей
- Вычисление параметров кристаллической решётки

### Выходные данные:
- Таблица характеристик:
  - Номер пика N
  - Угол 2θ (°)
  - Расстояние между плоскостями решетки
  - Максимальная интенсивность (имп / сек)
  - Относительная максимальная интенсивность (%)
  - Интегральная интенсивность (имп^2 / сек^2)
  - Относительная интегральная интенсивность (%)
  - Отношение β (интегральная интенсивность пика / максимальная интенсивность пика)
  - Площадь пика на уровне 1/2*h
- Графики:
  - Исходная дифрактограмма
  - Базовая линия
  - Обозначенные пики
- Экспорт в форматах:
  - .txt (отчёт)
  - .csv/.json (таблицы)
  - .png/.svg (графики)

## Технический стек

- **Язык программирования**: Python 3.10+
- **Фреймворк интерфейса**: Marimo
- **Математические вычисления**:
  - NumPy
  - SciPy
  - Scikit-Learn
- **Визуализация**: Vega-Altair
- **Обработка данных**: Polars
- **Дополнительные библиотеки**: vl-convert-python, json, os, sys, io, tempfile

## Требования к системе

- Современный браузер с поддержкой HTML5
- Рекомендуемая среда разработки: Visual Studio Code
- Установленный Python 3.10 или новее

## Пример использования

1. Запустите приложение с помощью bash-скрипта:
```bash
marimo run App.py
```
либо с помощью bash-скрипта для запуска ноутбука и модификации:
```bash
marimo edit
```

2. В открывшемся интерфейсе:
   - Выберите дифрактограмму в форме выбора файла
   - Введите параметры для для сглаживания и выявления дифракционных пиков
   - Введите масштаб графика для отображения (высота и ширина графика)

3. Для экспорта результатов:
   - Используйте соответствующие кнопки интерфейса marimo либо встроенные кнопки рядом с отображаемыми таблицами/изображениями
   - Форматы экспорта: для табличных данных - **.json, .csv**; для графиков - **.png, .svg**, для отчета - **.txt**

4. Для разработки/модификации:
```bash
marimo edit
```

## Поддержка

Для вопросов и предложений обращайтесь в Институт перспективных технологий и индустриального программирования (ИПТИП).
